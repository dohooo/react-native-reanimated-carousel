appId: ${APP_ID}
---

# Ensure a clean restart so the app always opens on the home screen,
# even if a previous test left it on the E2E page.
- stopApp
- launchApp:
    clearState: true

# Wait for the app to fully load
- waitForAnimationToEnd:
    timeout: 5000

# In CI, Expo Dev Client may open on the "Development Servers" screen first.
- tapOn:
    text: "http://localhost:8081"
    optional: true

# Wait for the app UI to fully stabilize after launch / Metro connection.
# A generous delay here avoids kAXErrorInvalidUIElement that Maestro's
# XCTest driver throws when querying the view hierarchy during transitions.
- waitForAnimationToEnd:
    timeout: 10000

# Expo shows a developer-menu onboarding modal on first launch.
# Use extendedWaitUntil so Maestro keeps polling until the modal appears
# (or the timeout expires if it was already dismissed in a prior run).
- extendedWaitUntil:
    visible: "Continue"
    timeout: 30000
    optional: true

- tapOn:
    text: "Continue"
    optional: true

- tapOn:
    text: "Close"
    optional: true

# Wait until the home screen demos list is loaded.
- extendedWaitUntil:
    visible: "Normal"
    timeout: 30000

# Navigate to E2E test page via deterministic top-of-list entry.
- tapOn:
    id: "navigate-e2e-comprehensive"

- waitForAnimationToEnd:
    timeout: 2000

# Wait for the E2E test page to fully load
- extendedWaitUntil:
    visible: "Reset All"
    timeout: 60000

# Reset all settings to default (in case previous test left modified state)
- scrollUntilVisible:
    element: "Reset All"
    direction: DOWN
    timeout: 5000

- tapOn:
    id: "btn-reset"

- waitForAnimationToEnd:
    timeout: 3000

# Scroll back to top to verify initial state
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200

- waitForAnimationToEnd:
    timeout: 2000

# Verify initial state
- assertVisible: "Slide 0"
- assertVisible: "Current Index: 0"
