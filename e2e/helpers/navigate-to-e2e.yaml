appId: ${APP_ID}
---

# Ensure a clean restart so the app always opens on the home screen,
# even if a previous test left it on the E2E page.
- stopApp
- launchApp:
    clearState: true

# Wait for the app to fully load
- waitForAnimationToEnd:
    timeout: 5000

# Android emulators can show a transient ANR dialog ("Process system isn't responding").
# If present, dismiss it and continue the run.
- tapOn:
    text: "Wait"
    optional: true

# In CI, Expo Dev Client may open on the "Development Servers" screen first.
- tapOn:
    text: "http://localhost:8081"
    optional: true

# Android Dev Launcher usually shows emulator loopback instead of localhost.
- tapOn:
    text: "http://10.0.2.2:8081"
    optional: true

# Wait for the app UI to fully stabilize after launch / Metro connection.
# A generous delay here avoids kAXErrorInvalidUIElement that Maestro's
# XCTest driver throws when querying the view hierarchy during transitions.
- waitForAnimationToEnd:
    timeout: 15000

# One more ANR dismissal pass after Dev Launcher taps.
- tapOn:
    text: "Wait"
    optional: true

# Expo shows a developer-menu onboarding modal on first launch.
# Use extendedWaitUntil so Maestro keeps polling until the modal appears
# (or the timeout expires if it was already dismissed in a prior run).
- extendedWaitUntil:
    visible: "Continue"
    timeout: 30000
    optional: true

- tapOn:
    text: "Continue"
    optional: true

- tapOn:
    text: "Close"
    optional: true

# Wait until the home screen is loaded. On slower Android emulators this can
# take noticeably longer than iOS. Prefer a text anchor because Android
# sometimes fails to expose the Pressable testID to Maestro.
- extendedWaitUntil:
    visible: "E2E"
    timeout: 90000

# Navigate to E2E test page.
- tapOn:
    id: "navigate-e2e-comprehensive"
    optional: true

- tapOn:
    text: "E2E"

- waitForAnimationToEnd:
    timeout: 2000

# Wait for the E2E test page to fully load
- extendedWaitUntil:
    visible: "Reset All"
    timeout: 60000

# Reset all settings to default (in case previous test left modified state)
- scrollUntilVisible:
    element: "Reset All"
    direction: DOWN
    timeout: 5000

- tapOn:
    id: "btn-reset"

- waitForAnimationToEnd:
    timeout: 3000

# Scroll back to top to verify initial state
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200
- swipe:
    start: "50%, 30%"
    end: "50%, 90%"
    duration: 200

- waitForAnimationToEnd:
    timeout: 2000

# Verify initial state
- assertVisible: "Slide 0"
- assertVisible: "Current Index: 0"
